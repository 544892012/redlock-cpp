{"name":"Redlock-cpp","tagline":"C++实现redis分布式锁","body":"redlock-cpp\r\n===========\r\n\r\nC++实现redis分布式锁\r\nredlock-cpp - Redis distributed locks in C++\r\n\r\nBased on Redlock-rb by Salvatore Sanfilippo\r\n\r\nThis library implements the Redis-based distributed lock manager algorithm described in this blog post.\r\n\r\nTo create a lock manager:\r\n\r\n    CRedLock * dlm = new CRedLock();\r\n    dlm->AddServerUrl(\"127.0.0.1\", 5005);\r\n    dlm->AddServerUrl(\"127.0.0.1\", 5006);\r\n    dlm->AddServerUrl(\"127.0.0.1\", 5007);\r\n\r\nTo acquire a lock:\r\n\r\n    CLock my_lock;\r\n    bool flag = dlm->Lock(\"my_resource_name\", 1000, my_lock);\r\nor(will alway hold the lock until release it):\r\n\r\n    CLock my_lock;\r\n    bool flag = dlm->ContinueLock(\"my_resource_name\", 1000, my_lock);\r\n\r\nWhere the resource name is an unique identifier of what you are trying to lock and 1000 is the number of milliseconds for the validity time.\r\n\r\nThe returned value is false if the lock was not acquired (you may try again), otherwise an class representing the lock is returned, having three keys:\r\n\r\n    class CLock {\r\n    public:\r\n        int m_validityTime; => 9897.3020019531 // 当前锁可以存活的时间, 毫秒\r\n        sds m_resource; => my_resource_name // 要锁住的资源名称\r\n        sds m_val; => 53771bfa1e775 // 锁住资源的进程随机名字\r\n    };\r\n\r\nvalidity, an integer representing the number of milliseconds the lock will be valid.\r\nresource, the name of the locked resource as specified by the user.\r\ntoken, a random token value which is used to safe reclaim the lock.\r\nTo release a lock:\r\n\r\n    dlm->Unlock(my_lock);\r\n    \r\nIt is possible to setup the number of retries (by default 3) and the retry delay (by default 200 milliseconds) used to acquire the lock.\r\n\r\nThe retry delay is actually chosen at random between $retryDelay / 2 milliseconds and the specified $retryDelay value.\r\n\r\nDisclaimer: As stated in the original antirez's version, this code implements an algorithm which is currently a proposal, it was not formally analyzed. Make sure to understand how it works before using it in your production environments.\r\n","google":"","note":"Don't delete this file! It's used internally to help with page regeneration."}